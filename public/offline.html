<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#1162ae" />
    <title>Modo Offline - INDI Ouro</title>
    <link rel="icon" href="/icon-192.png" type="image/png" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        min-height: 100vh;
        background: linear-gradient(135deg, #1162ae 0%, #0a4a8a 100%);
        color: white;
        display: flex;
        flex-direction: column;
      }
      
      .header {
        padding: 1rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      
      .header img {
        width: 40px;
        height: 40px;
      }
      
      .header h1 {
        font-size: 1.25rem;
        font-weight: 600;
      }
      
      .main {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        text-align: center;
      }
      
      .offline-icon {
        width: 80px;
        height: 80px;
        margin-bottom: 1.5rem;
        opacity: 0.9;
      }
      
      .main h2 {
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.75rem;
      }
      
      .main p {
        font-size: 1rem;
        opacity: 0.9;
        max-width: 320px;
        line-height: 1.5;
        margin-bottom: 2rem;
      }
      
      .status-card {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border-radius: 1rem;
        padding: 1.5rem;
        width: 100%;
        max-width: 320px;
        margin-bottom: 1.5rem;
      }
      
      .status-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      }
      
      .status-item:last-child {
        border-bottom: none;
      }
      
      .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
      }
      
      .status-dot.green { background: #22c55e; }
      .status-dot.yellow { background: #eab308; }
      .status-dot.red { background: #ef4444; }
      
      .status-text {
        flex: 1;
        text-align: left;
        font-size: 0.875rem;
      }
      
      .status-value {
        font-size: 0.875rem;
        opacity: 0.8;
      }
      
      .actions {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        width: 100%;
        max-width: 320px;
      }
      
      .btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.875rem 1.5rem;
        border: none;
        border-radius: 0.75rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        transition: all 0.2s;
      }
      
      .btn-primary {
        background: white;
        color: #1162ae;
      }
      
      .btn-primary:hover {
        background: #f0f0f0;
        transform: translateY(-1px);
      }
      
      .btn-secondary {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }
      
      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.3);
      }
      
      .quick-links {
        margin-top: 2rem;
        width: 100%;
        max-width: 320px;
      }
      
      .quick-links h3 {
        font-size: 0.875rem;
        font-weight: 600;
        opacity: 0.8;
        margin-bottom: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      
      .links-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
      }
      
      .quick-link {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 0.5rem;
        color: white;
        text-decoration: none;
        font-size: 0.875rem;
        transition: background 0.2s;
      }
      
      .quick-link:hover {
        background: rgba(255, 255, 255, 0.2);
      }
      
      .quick-link svg {
        width: 18px;
        height: 18px;
        opacity: 0.8;
      }
      
      .footer {
        padding: 1rem;
        text-align: center;
        font-size: 0.75rem;
        opacity: 0.6;
      }
      
      #connection-status {
        display: none;
        position: fixed;
        top: 1rem;
        left: 50%;
        transform: translateX(-50%);
        background: #22c55e;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 2rem;
        font-weight: 600;
        animation: slideDown 0.3s ease;
        z-index: 100;
      }
      
      @keyframes slideDown {
        from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        to { opacity: 1; transform: translateX(-50%) translateY(0); }
      }
      
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }
      
      .pulse {
        animation: pulse 2s ease-in-out infinite;
      }
    </style>
  </head>
  <body>
    <div id="connection-status">✓ Conexão restaurada!</div>
    
    <header class="header">
      <img src="/logo.svg" alt="INDI Ouro" onerror="this.style.display='none'" />
      <h1>INDI Ouro</h1>
    </header>
    
    <main class="main">
      <svg class="offline-icon pulse" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8.288 15.038a5.25 5.25 0 017.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0" />
        <line x1="3" y1="3" x2="21" y2="21" stroke-linecap="round" />
      </svg>
      
      <h2>Você está offline</h2>
      <p>Não se preocupe! Seus dados estão salvos localmente e serão sincronizados quando a conexão voltar.</p>
      
      <div class="status-card">
        <div class="status-item">
          <span class="status-dot yellow"></span>
          <span class="status-text">Conexão com internet</span>
          <span class="status-value" id="network-status">Offline</span>
        </div>
        <div class="status-item">
          <span class="status-dot green"></span>
          <span class="status-text">Dados locais</span>
          <span class="status-value">Disponíveis</span>
        </div>
        <div class="status-item">
          <span class="status-dot" id="sync-dot"></span>
          <span class="status-text">Pendentes para sync</span>
          <span class="status-value" id="pending-count">Verificando...</span>
        </div>
      </div>
      
      <div class="actions">
        <button class="btn btn-primary" onclick="tryReload()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 4v5h5M20 20v-5h-5M4 9a9 9 0 0115 6.7M20 15a9 9 0 01-15-6.7" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Tentar reconectar
        </button>
        <a href="/home" class="btn btn-secondary">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Ir para Home
        </a>
      </div>
      
      <div class="quick-links">
        <h3>Acesso Rápido (Offline)</h3>
        <div class="links-grid">
          <a href="/bois" class="quick-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Animais
          </a>
          <a href="/matrizes" class="quick-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M12 6v6l4 2" stroke-linecap="round"/>
            </svg>
            Matrizes
          </a>
          <a href="/vacinas" class="quick-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Vacinas
          </a>
          <a href="/gerenciar" class="quick-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Gerenciar
          </a>
        </div>
      </div>
    </main>
    
    <footer class="footer">
      <p>INDI Ouro • Funcionando em modo offline</p>
    </footer>
    
    <script>
      // Check for pending sync items
      async function checkPendingSync() {
        const pendingEl = document.getElementById('pending-count');
        const syncDot = document.getElementById('sync-dot');
        
        try {
          const db = await new Promise((resolve, reject) => {
            const request = indexedDB.open('offline-sync-queue', 1);
            request.onsuccess = () => resolve(request.result);
            request.onerror = () => reject(request.error);
            request.onupgradeneeded = (e) => {
              const database = e.target.result;
              if (!database.objectStoreNames.contains('requests')) {
                database.createObjectStore('requests', { keyPath: 'id' });
              }
            };
          });
          
          const transaction = db.transaction('requests', 'readonly');
          const store = transaction.objectStore('requests');
          
          const count = await new Promise((resolve) => {
            const countRequest = store.count();
            countRequest.onsuccess = () => resolve(countRequest.result);
            countRequest.onerror = () => resolve(0);
          });
          
          pendingEl.textContent = count > 0 ? `${count} item${count !== 1 ? 's' : ''}` : 'Nenhum';
          syncDot.className = 'status-dot ' + (count > 0 ? 'yellow' : 'green');
          
          db.close();
        } catch (e) {
          pendingEl.textContent = 'N/A';
          syncDot.className = 'status-dot green';
        }
      }
      
      // Try to reload
      function tryReload() {
        window.location.reload();
      }
      
      // Monitor connection status
      function updateConnectionStatus() {
        const statusEl = document.getElementById('network-status');
        const connectionNotif = document.getElementById('connection-status');
        
        if (navigator.onLine) {
          statusEl.textContent = 'Online';
          statusEl.parentElement.querySelector('.status-dot').className = 'status-dot green';
          connectionNotif.style.display = 'block';
          
          // Redirect to home after showing notification
          setTimeout(() => {
            window.location.href = '/home';
          }, 1500);
        } else {
          statusEl.textContent = 'Offline';
          statusEl.parentElement.querySelector('.status-dot').className = 'status-dot yellow';
        }
      }
      
      // Initialize
      checkPendingSync();
      updateConnectionStatus();
      
      // Listen for connection changes
      window.addEventListener('online', updateConnectionStatus);
      window.addEventListener('offline', updateConnectionStatus);
    </script>
  </body>
</html>